const t={name:"windy-plugin-knmi-qg-regions",version:"0.2.4",icon:"☀",title:"KNMI Solar Radiation",description:"Overlay KNMI 10 minute irradiance and wind metrics for Dutch regions and stations.",author:"Artis Byte",repository:"https://github.com/artis-byte/NL-solar",desktopUI:"rhpane",mobileUI:"fullscreen",routerPath:"/knmi-solar",private:!1,built:1760182372623,builtReadable:"2025-10-11T11:32:52.623Z",screenshot:"screenshot.jpg"},{map:e}=W.map;function n(){}function o(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(o)}function s(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e){t.appendChild(e)}function a(t,e,n){const o=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!o.getElementById(e)){const t=m("style");t.id=e,t.textContent=n,function(t,e){c(t.head||t,e),e.sheet}(o,t)}}function u(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function y(){return g(" ")}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function v(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t,e){e=""+e,t.data!==e&&(t.data=e)}function b(t,e){t.value=null==e?"":e}function $(t,e,n){t.classList.toggle(e,!!n)}let w;function x(t){w=t}function _(){if(!w)throw new Error("Function called outside component initialization");return w}const N=[],k=[];let F=[];const E=[],L=Promise.resolve();let S=!1;function C(t){F.push(t)}const A=new Set;let I=0;function D(){if(0!==I)return;const t=w;do{try{for(;I<N.length;){const t=N[I];I++,x(t),q(t.$$)}}catch(t){throw N.length=0,I=0,t}for(x(null),N.length=0,I=0;k.length;)k.pop()();for(let t=0;t<F.length;t+=1){const e=F[t];A.has(e)||(A.add(e),e())}F.length=0}while(N.length);for(;E.length;)E.pop()();S=!1,A.clear(),x(t)}function q(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(C)}}const M=new Set;function j(t){return void 0!==t?.length?t:Array.from(t)}function O(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];F.forEach(o=>-1===t.indexOf(o)?e.push(o):n.push(o)),n.forEach(t=>t()),F=e}(n.after_update),i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function T(t,e){-1===t.$$.dirty[0]&&(N.push(t),S||(S=!0,L.then(D)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function R(t,e,l,c,a,u,f=null,m=[-1]){const g=w;x(t);const y=t.$$={fragment:null,ctx:[],props:u,update:n,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:r(),dirty:m,skip_bound:!1,root:e.target||g.$$.root};f&&f(y.root);let p=!1;if(y.ctx=l?l(t,e.props||{},(e,n,...o)=>{const r=o.length?o[0]:n;return y.ctx&&a(y.ctx[e],y.ctx[e]=r)&&(!y.skip_bound&&y.bound[e]&&y.bound[e](r),p&&T(t,e)),n}):[],y.update(),p=!0,i(y.before_update),y.fragment=!!c&&c(y.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);y.fragment&&y.fragment.l(t),t.forEach(d)}else y.fragment&&y.fragment.c();e.intro&&((v=t.$$.fragment)&&v.i&&(M.delete(v),v.i(h))),function(t,e,n){const{fragment:r,after_update:l}=t.$$;r&&r.m(e,n),C(()=>{const e=t.$$.on_mount.map(o).filter(s);t.$$.on_destroy?t.$$.on_destroy.push(...e):i(e),t.$$.on_mount=[]}),l.forEach(C)}(t,e.target,e.anchor),D()}var v,h;x(g)}class z{$$=void 0;$$set=void 0;$destroy(){O(this,1),this.$destroy=n}$on(t,e){if(!s(e))return n;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(e),()=>{const t=o.indexOf(e);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function P(t){a(t,"svelte-v6ycdy","section.svelte-v6ycdy.svelte-v6ycdy{padding:0.75em;max-width:360px;font-family:sans-serif;font-size:0.9em;line-height:1.4;color:#1c1c1c}h1.svelte-v6ycdy.svelte-v6ycdy{font-size:1.2em;margin:0 0 0.4em}p.intro.svelte-v6ycdy.svelte-v6ycdy{margin:0 0 0.75em}.mode-buttons.svelte-v6ycdy.svelte-v6ycdy{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:0.35em;margin-bottom:0.5em}.mode-button.svelte-v6ycdy.svelte-v6ycdy{border:1px solid rgba(35, 35, 35, 0.6);border-radius:6px;padding:0.35em 0.5em;background:rgba(255, 255, 255, 0.85);color:#222;cursor:pointer;font-size:0.85em;text-align:center;transition:background 0.15s ease, color 0.15s ease, border 0.15s ease}.mode-button.svelte-v6ycdy.svelte-v6ycdy:hover{background:rgba(40, 120, 180, 0.12)}.mode-button.selected.svelte-v6ycdy.svelte-v6ycdy{background:#1f6fb2;color:#fff;border-color:#1f6fb2}.filter-group.svelte-v6ycdy.svelte-v6ycdy{margin:0.5em 0 0.75em;display:flex;flex-direction:column;gap:0.35em}.filter-group.svelte-v6ycdy label.svelte-v6ycdy{font-weight:600}.station-input.svelte-v6ycdy.svelte-v6ycdy{padding:0.35em 0.45em;border-radius:4px;border:1px solid rgba(40, 40, 40, 0.35)}.status.svelte-v6ycdy.svelte-v6ycdy{margin:0.75em 0 0}.status.error.svelte-v6ycdy.svelte-v6ycdy{color:#b03a2e}.legend.svelte-v6ycdy.svelte-v6ycdy{margin-top:1em;border-top:1px solid #bcbcbc;padding-top:0.75em;color:#111}.legend-title.svelte-v6ycdy.svelte-v6ycdy{font-weight:600;margin-bottom:0.4em}.legend-row.svelte-v6ycdy.svelte-v6ycdy{display:flex;align-items:center;margin-bottom:0.25em}.legend-swatch.svelte-v6ycdy.svelte-v6ycdy{width:18px;height:12px;margin-right:0.5em;border:1px solid #333333;box-sizing:border-box}.footer.svelte-v6ycdy.svelte-v6ycdy{margin-top:1em;font-size:0.8em;color:#444}a.svelte-v6ycdy.svelte-v6ycdy{color:#0b63c1}")}function B(t,e,n){const o=t.slice();return o[37]=e[n],o}function K(t,e,n){const o=t.slice();return o[40]=e[n],o}function U(t,e,n){const o=t.slice();return o[43]=e[n],o}function G(t){let e,n,o;function r(){return t[12](t[43])}return{c(){e=m("button"),e.textContent=`${t[43].label} `,v(e,"type","button"),v(e,"class","mode-button svelte-v6ycdy"),$(e,"selected",t[5]===t[43].id)},m(t,i){u(t,e,i),n||(o=p(e,"click",r),n=!0)},p(n,o){t=n,288&o[0]&&$(e,"selected",t[5]===t[43].id)},d(t){t&&d(e),n=!1,o()}}}function H(t){let e,n,o,r,i,s,l,a,g=j(t[7]),h=[];for(let e=0;e<g.length;e+=1)h[e]=J(K(t,g,e));return{c(){e=m("div"),n=m("label"),n.textContent="Show station (ID contains)",o=y(),r=m("input"),i=y(),s=m("datalist");for(let t=0;t<h.length;t+=1)h[t].c();v(n,"for","station-filter"),v(n,"class","svelte-v6ycdy"),v(r,"id","station-filter"),v(r,"class","station-input svelte-v6ycdy"),v(r,"list","station-options"),v(r,"placeholder","e.g. 06280"),r.value=t[6],v(s,"id","station-options"),v(e,"class","filter-group svelte-v6ycdy")},m(d,f){u(d,e,f),c(e,n),c(e,o),c(e,r),c(e,i),c(e,s);for(let t=0;t<h.length;t+=1)h[t]&&h[t].m(s,null);l||(a=p(r,"input",t[11]),l=!0)},p(t,e){if(64&e[0]&&r.value!==t[6]&&(r.value=t[6]),128&e[0]){let n;for(g=j(t[7]),n=0;n<g.length;n+=1){const o=K(t,g,n);h[n]?h[n].p(o,e):(h[n]=J(o),h[n].c(),h[n].m(s,null))}for(;n<h.length;n+=1)h[n].d(1);h.length=g.length}},d(t){t&&d(e),f(h,t),l=!1,a()}}}function J(t){let e,n;return{c(){e=m("option"),e.__value=n=t[40],b(e,e.__value)},m(t,n){u(t,e,n)},p(t,o){128&o[0]&&n!==(n=t[40])&&(e.__value=n,b(e,e.__value))},d(t){t&&d(e)}}}function V(t){let e,n,o,r=rt(t[2])+"";return{c(){e=m("p"),n=g("Last refreshed: "),o=g(r),v(e,"class","status svelte-v6ycdy")},m(t,r){u(t,e,r),c(e,n),c(e,o)},p(t,e){4&e[0]&&r!==(r=rt(t[2])+"")&&h(o,r)},d(t){t&&d(e)}}}function Z(t){let e,n;return{c(){e=m("p"),n=g(t[1]),v(e,"class","status error svelte-v6ycdy")},m(t,o){u(t,e,o),c(e,n)},p(t,e){2&e[0]&&h(n,t[1])},d(t){t&&d(e)}}}function Q(t){let e;return{c(){e=m("p"),e.textContent="Loading latest data...",v(e,"class","status svelte-v6ycdy")},m(t,n){u(t,e,n)},p:n,d(t){t&&d(e)}}}function X(t){let e,n,o,r,i,s=t[4]?` (${t[4]})`:"",l=j(t[3]),a=[];for(let e=0;e<l.length;e+=1)a[e]=Y(B(t,l,e));return{c(){e=m("div"),n=m("div"),o=g("Legend"),r=g(s),i=y();for(let t=0;t<a.length;t+=1)a[t].c();v(n,"class","legend-title svelte-v6ycdy"),v(e,"class","legend svelte-v6ycdy")},m(t,s){u(t,e,s),c(e,n),c(n,o),c(n,r),c(e,i);for(let t=0;t<a.length;t+=1)a[t]&&a[t].m(e,null)},p(t,n){if(16&n[0]&&s!==(s=t[4]?` (${t[4]})`:"")&&h(r,s),8&n[0]){let o;for(l=j(t[3]),o=0;o<l.length;o+=1){const r=B(t,l,o);a[o]?a[o].p(r,n):(a[o]=Y(r),a[o].c(),a[o].m(e,null))}for(;o<a.length;o+=1)a[o].d(1);a.length=l.length}},d(t){t&&d(e),f(a,t)}}}function Y(t){let e,n,o,r,i,s,l,a=t[37].label+"";return{c(){e=m("div"),n=m("span"),r=y(),i=m("span"),s=g(a),l=y(),v(n,"class","legend-swatch svelte-v6ycdy"),v(n,"style",o=`background:${t[37].color}`),v(e,"class","legend-row svelte-v6ycdy")},m(t,o){u(t,e,o),c(e,n),c(e,r),c(e,i),c(i,s),c(e,l)},p(t,e){8&e[0]&&o!==(o=`background:${t[37].color}`)&&v(n,"style",o),8&e[0]&&a!==(a=t[37].label+"")&&h(s,a)},d(t){t&&d(e)}}}function tt(t){let e,o,r,i,s,l,a,p,h,b,$,w,x,_,N,k,F,E,L="stations"===t[9](t[5])?.type,S=j(t[8]),C=[];for(let e=0;e<S.length;e+=1)C[e]=G(U(t,S,e));let A=L&&H(t);function I(t,e){return t[0]?Q:t[1]?Z:t[2]?V:void 0}let D=I(t),q=D&&D(t),M=t[3].length&&X(t);return{c(){e=m("section"),o=m("h1"),o.textContent="KNMI Solar & Wind",r=y(),i=m("p"),i.textContent="Live KNMI 10 minute metrics. Toggle between regional averages and individual stations.",s=y(),l=m("div");for(let t=0;t<C.length;t+=1)C[t].c();a=y(),A&&A.c(),p=y(),q&&q.c(),h=y(),M&&M.c(),b=y(),$=m("p"),w=g("Sources: "),x=m("a"),_=g("region feed"),N=g(" ·\r\n    "),k=m("a"),F=g("station feed"),E=g(". Data refreshes every 10 minutes."),v(o,"class","svelte-v6ycdy"),v(i,"class","intro svelte-v6ycdy"),v(l,"class","mode-buttons svelte-v6ycdy"),v(x,"href",et),v(x,"target","_blank"),v(x,"rel","noopener"),v(x,"class","svelte-v6ycdy"),v(k,"href",nt),v(k,"target","_blank"),v(k,"rel","noopener"),v(k,"class","svelte-v6ycdy"),v($,"class","footer svelte-v6ycdy"),v(e,"class","svelte-v6ycdy")},m(t,n){u(t,e,n),c(e,o),c(e,r),c(e,i),c(e,s),c(e,l);for(let t=0;t<C.length;t+=1)C[t]&&C[t].m(l,null);c(e,a),A&&A.m(e,null),c(e,p),q&&q.m(e,null),c(e,h),M&&M.m(e,null),c(e,b),c(e,$),c($,w),c($,x),c(x,_),c($,N),c($,k),c(k,F),c($,E)},p(t,n){if(1312&n[0]){let e;for(S=j(t[8]),e=0;e<S.length;e+=1){const o=U(t,S,e);C[e]?C[e].p(o,n):(C[e]=G(o),C[e].c(),C[e].m(l,null))}for(;e<C.length;e+=1)C[e].d(1);C.length=S.length}32&n[0]&&(L="stations"===t[9](t[5])?.type),L?A?A.p(t,n):(A=H(t),A.c(),A.m(e,p)):A&&(A.d(1),A=null),D===(D=I(t))&&q?q.p(t,n):(q&&q.d(1),q=D&&D(t),q&&(q.c(),q.m(e,h))),t[3].length?M?M.p(t,n):(M=X(t),M.c(),M.m(e,b)):M&&(M.d(1),M=null)},i:n,o:n,d(t){t&&d(e),f(C,t),A&&A.d(),q&&q.d(),M&&M.d()}}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const et="https://raw.githubusercontent.com/artis-byte/NL-solar/main/qg_regions.geojson",nt="https://raw.githubusercontent.com/artis-byte/NL-solar/main/stations_live.geojson";function ot(t){if("number"!=typeof t||!Number.isFinite(t))return"n/a";const e=Math.abs(t);return e>=1e3||e>=100?t.toFixed(0):e>=10?t.toFixed(1):e>=1?t.toFixed(2):0===e?"0":t.toPrecision(2)}function rt(t){if(!t)return"";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleString()}function it(t,n,o){const r=["#800026","#BD0026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFEDA0"],i=[20,15,10,7,5,3,1],s=[{id:"region-qg",label:"Region irradiance",type:"region",metric:"qg_mean",units:"W/m^2",legend:"qg"},{id:"region-wind",label:"Region wind speed (10 min avg)",type:"region",metric:"ff_mean",units:"m/s (10 min avg)",legend:"wind"},{id:"stations-qg",label:"Station irradiance",type:"stations",metric:"qg",units:"W/m^2",legend:"qg"},{id:"stations-wind",label:"Station wind speed (10 min avg)",type:"stations",metric:"ff",units:"m/s (10 min avg)",legend:"wind"}];let l=null,c=null,a=null,u=null,d=null,f=null,m=!1,g="",y="",p=[],v="",h=s[0].id,b=null,$=null,w={},x="",N=[];function k(t){return s.find(e=>e.id===t)}function F(){return c||"undefined"==typeof window||(c=window.L||null),c}function E(){return!!e&&(l=e,"function"==typeof l.addLayer)}function L(t,e){if("qg"===t.legend)return[800,600,400,200,100,50,10];if("wind"===t.legend)return i;if(e&&Number.isFinite(e.min)&&Number.isFinite(e.max)){const t=r.length-1,n=e.max-e.min;if(n<=0)return[];const o=[];for(let r=t;r>=1;r-=1)o.push(e.min+n*r/t);return o}return[]}function S(t,e){if("number"!=typeof t||!Number.isFinite(t))return"#7f7f7f";if(!e.length)return r[Math.floor(r.length/2)];for(let n=0;n<e.length;n+=1)if(t>=e[n])return r[n];return r[r.length-1]}function C(t,e){const n=[];for(let o=0;o<r.length;o+=1){let i="";i=t.length?0===o?`>= ${ot(t[0])}`:o===r.length-1?`< ${ot(t[t.length-1])}`:`${ot(t[o-1])} - ${ot(t[o])}`:0===o?"Higher values":o===r.length-1?"Lower values":"",i&&n.push({color:r[o],label:e.units?`${i} ${e.units}`:i})}return n}function A(){a&&F()&&(l&&"function"==typeof l.removeLayer&&l.removeLayer(a),a=null),u&&F()&&(l&&"function"==typeof l.removeLayer&&l.removeLayer(u),u=null)}function I(){const t=k(h);t&&(o(1,g=""),"region"===t.type?function(t){const e=F();if(!e||!E()||!b)return;const n=w[t.metric];if(!n)return o(1,g="Selected region metric is not available in the dataset."),A(),void o(3,p=[]);const r=L(t,n);o(4,v=t.units),o(3,p=C(r,t)),A(),a=e.geoJSON(b,{style:e=>{const n=e?.properties?.[t.metric];return{fillColor:S(n,r),fillOpacity:.6,weight:1,color:"#333333"}},onEachFeature:(t,e)=>{const n=t?.properties||{},o=[],r=n.name||"Region";o.push(`<strong>${r}</strong>`);const i=n.qg_mean;Number.isFinite(i)&&o.push(`Irradiance: ${ot(i)} W/m^2`);const s=n.ff_mean;Number.isFinite(s)&&o.push(`Wind (10 min avg): ${ot(s)} m/s`),Number.isFinite(n.estimated_output_mw)&&o.push(`Estimated PV output: ${ot(n.estimated_output_mw)} MW`);const l=o.join("<br>");e.bindPopup(l),e.bindTooltip(l,{permanent:!0,direction:"center",className:"region-tooltip"})}}).addTo(l)}(t):function(t){const e=F();if(!e||!E()||!$)return;const n=w[t.metric];if(!n)return o(1,g="Station dataset does not include the selected metric."),A(),void o(3,p=[]);const r=L(t,n);o(4,v=t.units),o(3,p=C(r,t)),A(),u=e.layerGroup();const i=Array.isArray($?.features)?$.features:[],s=x.trim().toLowerCase();for(const n of i){const o=n?.properties||{},i=n?.geometry?.coordinates;if(!Array.isArray(i)||i.length<2)continue;const l=String(o.station??"");if(s&&!l.toLowerCase().includes(s))continue;const c=i[1],a=i[0],d=S(o[t.metric],r),f=s?8:6,m=e.circleMarker([c,a],{radius:f,color:"#1c1c1c",weight:1,fillColor:d,fillOpacity:.85}),g=[`<strong>Station ${l}</strong>`,`Irradiance: ${ot(o.qg)} W/m^2`,`Wind (10 min avg): ${ot(o.ff)} m/s`].join("<br>");m.bindTooltip(g,{permanent:!0,direction:"top",className:"station-tooltip"}),m.addTo(u)}u.addTo(l)}(t))}async function D(){o(0,m=!0),o(1,g="");try{const[t,e]=await Promise.all([fetch(`${et}?t=${Date.now()}`,{cache:"no-store"}),fetch(`${nt}?t=${Date.now()}`,{cache:"no-store"})]);if(!t.ok)throw new Error(`Failed to fetch region data (${t.status})`);if(!e.ok)throw new Error(`Failed to fetch station data (${e.status})`);b=await t.json(),$=await e.json(),w={},[b,$].forEach(t=>{const e=Array.isArray(t?.features)?t.features:[];for(const t of e){const e=t?.properties;if(e)for(const[t,n]of Object.entries(e))if("number"==typeof n&&Number.isFinite(n)){const e=w[t]||{min:n,max:n};e.min=Math.min(e.min,n),e.max=Math.max(e.max,n),w[t]=e}}}),o(7,N=Array.from(new Set(($?.features||[]).map(t=>t?.properties?.station).filter(t=>null!=t).map(t=>String(t)))).sort((t,e)=>t.localeCompare(e))),o(2,y=(new Date).toISOString()),I()}catch(t){console.error("Failed to refresh KNMI data",t),o(1,g=t?.message||String(t)),A(),o(3,p=[])}finally{o(0,m=!1)}}function q(t){h!==t&&(o(5,h=t),I())}var M;M=()=>{F(),E(),D(),d=setInterval(D,6e5),f=setInterval(()=>{!l&&E()&&I()},1e3)},_().$$.on_mount.push(M),function(t){_().$$.on_destroy.push(t)}(()=>{d&&(clearInterval(d),d=null),f&&(clearInterval(f),f=null),A()});return[m,g,y,p,v,h,x,N,s,k,q,function(t){o(6,x=t.currentTarget.value),"stations"===k(h)?.type&&I()},t=>q(t.id)]}class st extends z{constructor(t){super(),R(this,t,it,tt,l,{},P,[-1,-1])}}export{t as __pluginConfig,st as default};
