const t={name:"windy-plugin-knmi-qg-regions",version:"0.2.4",icon:"☀",title:"KNMI Solar Radiation",description:"Overlay KNMI 10 minute irradiance and wind metrics for Dutch regions and stations.",author:"Artis Byte",repository:"https://github.com/artis-byte/NL-solar",desktopUI:"rhpane",mobileUI:"fullscreen",routerPath:"/knmi-solar",private:!1,built:1760169687524,builtReadable:"2025-10-11T08:01:27.524Z",screenshot:"screenshot.jpg"},{map:e}=W.map;function n(){}function o(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(o)}function s(t){return"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function a(t,e,n){const o=function(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;if(e&&e.host)return e;return t.ownerDocument}(t);if(!o.getElementById(e)){const t=m("style");t.id=e,t.textContent=n,function(t,e){l(t.head||t,e),e.sheet}(o,t)}}function u(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function g(){return p(" ")}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e){e=""+e,t.data!==e&&(t.data=e)}function v(t,e,n){t.classList.toggle(e,!!n)}let $;function y(t){$=t}function w(){if(!$)throw new Error("Function called outside component initialization");return $}const x=[],_=[];let N=[];const k=[],F=Promise.resolve();let E=!1;function L(t){N.push(t)}const S=new Set;let A=0;function I(){if(0!==A)return;const t=$;do{try{for(;A<x.length;){const t=x[A];A++,y(t),C(t.$$)}}catch(t){throw x.length=0,A=0,t}for(y(null),x.length=0,A=0;_.length;)_.pop()();for(let t=0;t<N.length;t+=1){const e=N[t];S.has(e)||(S.add(e),e())}N.length=0}while(x.length);for(;k.length;)k.pop()();E=!1,S.clear(),y(t)}function C(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}const D=new Set;function q(t){return void 0!==t?.length?t:Array.from(t)}function M(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];N.forEach(o=>-1===t.indexOf(o)?e.push(o):n.push(o)),n.forEach(t=>t()),N=e}(n.after_update),i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function j(t,e){-1===t.$$.dirty[0]&&(x.push(t),E||(E=!0,F.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(t,e,c,l,a,u,f=null,m=[-1]){const p=$;y(t);const g=t.$$={fragment:null,ctx:[],props:u,update:n,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(p?p.$$.context:[])),callbacks:r(),dirty:m,skip_bound:!1,root:e.target||p.$$.root};f&&f(g.root);let h=!1;if(g.ctx=c?c(t,e.props||{},(e,n,...o)=>{const r=o.length?o[0]:n;return g.ctx&&a(g.ctx[e],g.ctx[e]=r)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](r),h&&j(t,e)),n}):[],g.update(),h=!0,i(g.before_update),g.fragment=!!l&&l(g.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);g.fragment&&g.fragment.l(t),t.forEach(d)}else g.fragment&&g.fragment.c();e.intro&&((b=t.$$.fragment)&&b.i&&(D.delete(b),b.i(v))),function(t,e,n){const{fragment:r,after_update:c}=t.$$;r&&r.m(e,n),L(()=>{const e=t.$$.on_mount.map(o).filter(s);t.$$.on_destroy?t.$$.on_destroy.push(...e):i(e),t.$$.on_mount=[]}),c.forEach(L)}(t,e.target,e.anchor),I()}var b,v;y(p)}class T{$$=void 0;$$set=void 0;$destroy(){M(this,1),this.$destroy=n}$on(t,e){if(!s(e))return n;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(e),()=>{const t=o.indexOf(e);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function R(t){a(t,"svelte-13p1d4c","section.svelte-13p1d4c{padding:0.75em;max-width:360px;font-family:sans-serif;font-size:0.9em;line-height:1.4;color:#1c1c1c}h1.svelte-13p1d4c{font-size:1.2em;margin:0 0 0.4em}p.intro.svelte-13p1d4c{margin:0 0 0.75em}.mode-buttons.svelte-13p1d4c{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:0.35em;margin-bottom:0.5em}.mode-button.svelte-13p1d4c{border:1px solid rgba(35, 35, 35, 0.6);border-radius:6px;padding:0.35em 0.5em;background:rgba(255, 255, 255, 0.85);color:#222;cursor:pointer;font-size:0.85em;text-align:center;transition:background 0.15s ease, color 0.15s ease, border 0.15s ease}.mode-button.svelte-13p1d4c:hover{background:rgba(40, 120, 180, 0.12)}.mode-button.selected.svelte-13p1d4c{background:#1f6fb2;color:#fff;border-color:#1f6fb2}.status.svelte-13p1d4c{margin:0.75em 0 0}.status.error.svelte-13p1d4c{color:#b03a2e}.legend.svelte-13p1d4c{margin-top:1em;border-top:1px solid #bcbcbc;padding-top:0.75em;color:#111}.legend-title.svelte-13p1d4c{font-weight:600;margin-bottom:0.4em}.legend-row.svelte-13p1d4c{display:flex;align-items:center;margin-bottom:0.25em}.legend-swatch.svelte-13p1d4c{width:18px;height:12px;margin-right:0.5em;border:1px solid #333333;box-sizing:border-box}.footer.svelte-13p1d4c{margin-top:1em;font-size:0.8em;color:#444}a.svelte-13p1d4c{color:#0b63c1}")}function z(t,e,n){const o=t.slice();return o[34]=e[n],o}function P(t,e,n){const o=t.slice();return o[37]=e[n],o}function B(t){let e,n,o;function r(){return t[8](t[37])}return{c(){e=m("button"),e.textContent=`${t[37].label} `,h(e,"type","button"),h(e,"class","mode-button svelte-13p1d4c"),v(e,"selected",t[5]===t[37].id)},m(t,i){var s,c,l,a;u(t,e,i),n||(c="click",l=r,(s=e).addEventListener(c,l,a),o=()=>s.removeEventListener(c,l,a),n=!0)},p(n,o){t=n,96&o[0]&&v(e,"selected",t[5]===t[37].id)},d(t){t&&d(e),n=!1,o()}}}function K(t){let e,n,o,r=Y(t[2])+"";return{c(){e=m("p"),n=p("Last refreshed: "),o=p(r),h(e,"class","status svelte-13p1d4c")},m(t,r){u(t,e,r),l(e,n),l(e,o)},p(t,e){4&e[0]&&r!==(r=Y(t[2])+"")&&b(o,r)},d(t){t&&d(e)}}}function U(t){let e,n;return{c(){e=m("p"),n=p(t[1]),h(e,"class","status error svelte-13p1d4c")},m(t,o){u(t,e,o),l(e,n)},p(t,e){2&e[0]&&b(n,t[1])},d(t){t&&d(e)}}}function G(t){let e;return{c(){e=m("p"),e.textContent="Loading latest data...",h(e,"class","status svelte-13p1d4c")},m(t,n){u(t,e,n)},p:n,d(t){t&&d(e)}}}function H(t){let e,n,o,r,i,s=t[4]?` (${t[4]})`:"",c=q(t[3]),a=[];for(let e=0;e<c.length;e+=1)a[e]=J(z(t,c,e));return{c(){e=m("div"),n=m("div"),o=p("Legend"),r=p(s),i=g();for(let t=0;t<a.length;t+=1)a[t].c();h(n,"class","legend-title svelte-13p1d4c"),h(e,"class","legend svelte-13p1d4c")},m(t,s){u(t,e,s),l(e,n),l(n,o),l(n,r),l(e,i);for(let t=0;t<a.length;t+=1)a[t]&&a[t].m(e,null)},p(t,n){if(16&n[0]&&s!==(s=t[4]?` (${t[4]})`:"")&&b(r,s),8&n[0]){let o;for(c=q(t[3]),o=0;o<c.length;o+=1){const r=z(t,c,o);a[o]?a[o].p(r,n):(a[o]=J(r),a[o].c(),a[o].m(e,null))}for(;o<a.length;o+=1)a[o].d(1);a.length=c.length}},d(t){t&&d(e),f(a,t)}}}function J(t){let e,n,o,r,i,s,c,a=t[34].label+"";return{c(){e=m("div"),n=m("span"),r=g(),i=m("span"),s=p(a),c=g(),h(n,"class","legend-swatch svelte-13p1d4c"),h(n,"style",o=`background:${t[34].color}`),h(e,"class","legend-row svelte-13p1d4c")},m(t,o){u(t,e,o),l(e,n),l(e,r),l(e,i),l(i,s),l(e,c)},p(t,e){8&e[0]&&o!==(o=`background:${t[34].color}`)&&h(n,"style",o),8&e[0]&&a!==(a=t[34].label+"")&&b(s,a)},d(t){t&&d(e)}}}function V(t){let e,o,r,i,s,c,a,b,v,$,y,w,x,_,N,k,F,E=q(t[6]),L=[];for(let e=0;e<E.length;e+=1)L[e]=B(P(t,E,e));function S(t,e){return t[0]?G:t[1]?U:t[2]?K:void 0}let A=S(t),I=A&&A(t),C=t[3].length&&H(t);return{c(){e=m("section"),o=m("h1"),o.textContent="KNMI Solar & Wind",r=g(),i=m("p"),i.textContent="Live KNMI 10 minute metrics. Toggle between regional averages and individual stations.",s=g(),c=m("div");for(let t=0;t<L.length;t+=1)L[t].c();a=g(),I&&I.c(),b=g(),C&&C.c(),v=g(),$=m("p"),y=p("Sources: "),w=m("a"),x=p("region feed"),_=p(" ·\r\n    "),N=m("a"),k=p("station feed"),F=p(". Data refreshes every 10 minutes."),h(o,"class","svelte-13p1d4c"),h(i,"class","intro svelte-13p1d4c"),h(c,"class","mode-buttons svelte-13p1d4c"),h(w,"href",Z),h(w,"target","_blank"),h(w,"rel","noopener"),h(w,"class","svelte-13p1d4c"),h(N,"href",Q),h(N,"target","_blank"),h(N,"rel","noopener"),h(N,"class","svelte-13p1d4c"),h($,"class","footer svelte-13p1d4c"),h(e,"class","svelte-13p1d4c")},m(t,n){u(t,e,n),l(e,o),l(e,r),l(e,i),l(e,s),l(e,c);for(let t=0;t<L.length;t+=1)L[t]&&L[t].m(c,null);l(e,a),I&&I.m(e,null),l(e,b),C&&C.m(e,null),l(e,v),l(e,$),l($,y),l($,w),l(w,x),l($,_),l($,N),l(N,k),l($,F)},p(t,n){if(224&n[0]){let e;for(E=q(t[6]),e=0;e<E.length;e+=1){const o=P(t,E,e);L[e]?L[e].p(o,n):(L[e]=B(o),L[e].c(),L[e].m(c,null))}for(;e<L.length;e+=1)L[e].d(1);L.length=E.length}A===(A=S(t))&&I?I.p(t,n):(I&&I.d(1),I=A&&A(t),I&&(I.c(),I.m(e,b))),t[3].length?C?C.p(t,n):(C=H(t),C.c(),C.m(e,v)):C&&(C.d(1),C=null)},i:n,o:n,d(t){t&&d(e),f(L,t),I&&I.d(),C&&C.d()}}}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const Z="https://raw.githubusercontent.com/artis-byte/NL-solar/main/qg_regions.geojson",Q="https://raw.githubusercontent.com/artis-byte/NL-solar/main/stations_live.geojson";function X(t){if("number"!=typeof t||!Number.isFinite(t))return"n/a";const e=Math.abs(t);return e>=1e3||e>=100?t.toFixed(0):e>=10?t.toFixed(1):e>=1?t.toFixed(2):0===e?"0":t.toPrecision(2)}function Y(t){if(!t)return"";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleString()}function tt(t,n,o){const r=["#800026","#BD0026","#E31A1C","#FC4E2A","#FD8D3C","#FEB24C","#FED976","#FFEDA0"],i=[20,15,10,7,5,3,1],s=[{id:"region-qg",label:"Region irradiance",type:"region",metric:"qg_mean",units:"W/m^2",legend:"qg"},{id:"region-wind",label:"Region wind",type:"region",metric:"ff_mean",units:"m/s",legend:"wind"},{id:"stations-qg",label:"Stations irradiance",type:"stations",metric:"qg",units:"W/m^2",legend:"qg"},{id:"stations-wind",label:"Stations wind",type:"stations",metric:"ff",units:"m/s",legend:"wind"}];let c=null,l=null,a=null,u=null,d=null,f=null,m=!1,p="",g="",h=[],b="",v=s[0].id,$=null,y=null,x={};function _(){return l||"undefined"==typeof window||(l=window.L||null),l}function N(){return!!e&&(c=e,"function"==typeof c.addLayer)}function k(t,e){if("qg"===t.legend)return[800,600,400,200,100,50,10];if("wind"===t.legend)return i;if(e&&Number.isFinite(e.min)&&Number.isFinite(e.max)){const t=r.length-1,n=e.max-e.min;if(n<=0)return[];const o=[];for(let r=t;r>=1;r-=1)o.push(e.min+n*r/t);return o}return[]}function F(t,e){if("number"!=typeof t||!Number.isFinite(t))return"#7f7f7f";if(!e.length)return r[Math.floor(r.length/2)];for(let n=0;n<e.length;n+=1)if(t>=e[n])return r[n];return r[r.length-1]}function E(t,e){const n=[];for(let o=0;o<r.length;o+=1){let i="";i=t.length?0===o?`>= ${X(t[0])}`:o===r.length-1?`< ${X(t[t.length-1])}`:`${X(t[o-1])} - ${X(t[o])}`:0===o?"Higher values":o===r.length-1?"Lower values":"",i&&n.push({color:r[o],label:e.units?`${i} ${e.units}`:i})}return n}function L(){a&&_()&&(c&&"function"==typeof c.removeLayer&&c.removeLayer(a),a=null),u&&_()&&(c&&"function"==typeof c.removeLayer&&c.removeLayer(u),u=null)}function S(){const t=(e=v,s.find(t=>t.id===e));var e;t&&(o(1,p=""),"region"===t.type?function(t){const e=_();if(!e||!N()||!$)return;const n=x[t.metric];if(!n)return o(1,p="Selected region metric is not available in the dataset."),L(),void o(3,h=[]);const r=k(t,n);o(4,b=t.units),o(3,h=E(r,t)),L(),a=e.geoJSON($,{style:e=>{const n=e?.properties?.[t.metric];return{fillColor:F(n,r),fillOpacity:.6,weight:1,color:"#333333"}},onEachFeature:(t,e)=>{const n=t?.properties||{},o=[],r=n.name||"Region";o.push(`<strong>${r}</strong>`);const i=n.qg_mean;Number.isFinite(i)&&o.push(`Irradiance: ${X(i)} W/m^2`);const s=n.ff_mean;Number.isFinite(s)&&o.push(`Wind: ${X(s)} m/s`),Number.isFinite(n.estimated_output_mw)&&o.push(`Estimated PV output: ${X(n.estimated_output_mw)} MW`),e.bindPopup(o.join("<br>"))}}).addTo(c)}(t):function(t){const e=_();if(!e||!N()||!y)return;const n=x[t.metric];if(!n)return o(1,p="Station dataset does not include the selected metric."),L(),void o(3,h=[]);const r=k(t,n);o(4,b=t.units),o(3,h=E(r,t)),L(),u=e.layerGroup();const i=Array.isArray(y?.features)?y.features:[];for(const n of i){const o=n?.properties||{},i=n?.geometry?.coordinates;if(!Array.isArray(i)||i.length<2)continue;const s=i[1],c=i[0],l=F(o[t.metric],r),a=e.circleMarker([s,c],{radius:6,color:"#1c1c1c",weight:1,fillColor:l,fillOpacity:.85}),d=[`<strong>Station ${o.station??""}</strong>`,`Irradiance: ${X(o.qg)} W/m^2`,`Wind: ${X(o.ff)} m/s`].join("<br>");a.bindTooltip(d,{permanent:!0,direction:"top",className:"station-tooltip"}),a.addTo(u)}u.addTo(c)}(t))}async function A(){o(0,m=!0),o(1,p="");try{const[t,e]=await Promise.all([fetch(`${Z}?t=${Date.now()}`,{cache:"no-store"}),fetch(`${Q}?t=${Date.now()}`,{cache:"no-store"})]);if(!t.ok)throw new Error(`Failed to fetch region data (${t.status})`);if(!e.ok)throw new Error(`Failed to fetch station data (${e.status})`);$=await t.json(),y=await e.json(),x={},[$,y].forEach(t=>{const e=Array.isArray(t?.features)?t.features:[];for(const t of e){const e=t?.properties;if(e)for(const[t,n]of Object.entries(e))if("number"==typeof n&&Number.isFinite(n)){const e=x[t]||{min:n,max:n};e.min=Math.min(e.min,n),e.max=Math.max(e.max,n),x[t]=e}}}),o(2,g=(new Date).toISOString()),S()}catch(t){console.error("Failed to refresh KNMI data",t),o(1,p=t?.message||String(t)),L(),o(3,h=[])}finally{o(0,m=!1)}}function I(t){v!==t&&(o(5,v=t),S())}var C;C=()=>{_(),N(),A(),d=setInterval(A,6e5),f=setInterval(()=>{!c&&N()&&S()},1e3)},w().$$.on_mount.push(C),function(t){w().$$.on_destroy.push(t)}(()=>{d&&(clearInterval(d),d=null),f&&(clearInterval(f),f=null),L()});return[m,p,g,h,b,v,s,I,t=>I(t.id)]}class et extends T{constructor(t){super(),O(this,t,tt,V,c,{},R,[-1,-1])}}export{t as __pluginConfig,et as default};
